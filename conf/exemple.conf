# Configuration des serveurs virtuels
server {
    listen 8080; # Écoute sur le port HTTP
    listen 8081; # Écoute sur le port HTTP
    server_name example.com www.example.com; # Domaine(s) géré(s)
    root /var/www/html;
    index index.html index.htm index.php;

    client_body_buffer_size 128k;        # Taille du buffer pour le corps


    access_log /var/log/nginx/example.com.access.log;
    error_log /var/log/nginx/example.com.error.log;
    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;

    location ~* \.(jpg|jpeg|png|gif|ico|css|js|woff2)$ {
        expires 365d; # Cache pendant 1 an
        add_header Cache-Control "public, no-transform";
    }

    location ~ \.php$ {
        fastcgi_pass unix:/run/php/php8.1-fpm.sock; # Ajustez la version PHP
    }

    location ~* (\.env|\.git|\.svn|\.ht) {
        return 403;
    }
}
server{
    listen 8082;
}

# Fichier de configuration Nginx avec tous les paramètres possibles pour server {}

# Définition d'un bloc server
# server {
#     # Identification du serveur
#     listen 80;                          # Port d'écoute (IPv4)
#     listen [::]:80;                      # Port d'écoute (IPv6)
#     listen 443 ssl;                      # Port SSL (IPv4)
#     listen [::]:443 ssl;                 # Port SSL (IPv6)
#     listen 80 default_server;            # Serveur par défaut
#     listen [::]:80 default_server;
#     listen unix:/var/run/nginx.sock;     # Socket Unix
#
#     # SSL/TLS Configuration
#     ssl_certificate /path/to/cert.pem;   # Certificat SSL
#     ssl_certificate_key /path/to/key.pem;# Clé privée SSL
#     ssl_protocols TLSv1.2 TLSv1.3;       # Protocoles autorisés
#     ssl_ciphers HIGH:!aNULL:!MD5;        # Suites de chiffrement
#     ssl_prefer_server_ciphers on;        # Préférer les chiffrements serveur
#     ssl_session_cache shared:SSL:10m;    # Cache de session SSL
#     ssl_session_timeout 10m;             # Durée de session SSL
#
#     # Identification
#     server_name example.com www.example.com; # Noms de domaine
#     server_name_in_redirect off;         # Utiliser le server_name dans les redirections
#     server_tokens off;                   # Masquer la version de Nginx
#
#     # Chemins et fichiers
#     root /var/www/html;                  # Racine des documents
#     index index.html index.htm index.php; # Fichiers index par défaut
#     error_page 404 /404.html;            # Page d'erreur personnalisée
#     error_page 500 502 503 504 /50x.html;
#
#     # Journalisation
#     access_log /var/log/nginx/access.log; # Fichier de log d'accès
#     error_log /var/log/nginx/error.log;   # Fichier de log d'erreur
#     log_not_found on;                    # Logger les 404
#     log_subrequest on;                   # Logger les sous-requêtes
#
#     # Performances
#     sendfile on;                         # Utiliser sendfile
#     sendfile_max_chunk 1m;               # Taille max des chunks sendfile
#     tcp_nopush on;                       # Optimisation TCP
#     tcp_nodelay on;                      # Désactiver le délai Nagle
#     keepalive_timeout 65;                # Timeout keepalive
#     keepalive_requests 100;              # Nombre max de requêtes par connexion
#     client_max_body_size 10m;            # Taille max du corps de requête
#     client_body_buffer_size 128k;        # Taille du buffer pour le corps
#     client_header_buffer_size 1k;        # Taille du buffer pour les en-têtes
#     large_client_header_buffers 4 8k;    # Buffers pour gros en-têtes
#
#     # Sécurité
#     add_header X-Frame-Options DENY;     # Protection clickjacking
#     add_header X-Content-Type-Options nosniff;
#     add_header X-XSS-Protection "1; mode=block";
#     add_header Content-Security-Policy "default-src 'self'";
#     disable_symlinks off;                # Gestion des liens symboliques
#
#     # Encodage
#     charset utf-8;                       # Encodage par défaut
#     source_charset utf-8;                # Encodage des sources
#
#     # Redirections et réécritures
#     return 301 https://$host$request_uri; # Exemple de redirection
#     rewrite ^/oldpath$ /newpath permanent; # Exemple de réécriture
#
#     # Localisations (quelques exemples)
#     location / {
#         try_files $uri $uri/ =404;       # Essayer de servir les fichiers
#         autoindex off;                   # Désactiver l'indexation automatique
#         limit_except GET {               # Limiter les méthodes HTTP
#             deny all;
#         }
#     }
#
#     location ~ \.php$ {
#         fastcgi_pass unix:/var/run/php/php-fpm.sock;
#         fastcgi_index index.php;
#         include fastcgi_params;
#     }
#
#     location /private/ {
#         internal;                        # Accès interne seulement
#         alias /var/www/private/;
#     }
#
#     # Headers divers
#     expires 24h;                         # Cache-Control et Expires
#     etag on;                             # Activation ETag
#     if_modified_since exact;             # Comportement If-Modified-Since
#
#     # Variables personnalisées
#     set $my_variable "value";            # Définir une variable
#
#     # Gzip
#     gzip on;                             # Compression Gzip
#     gzip_types text/plain application/xml;
#     gzip_proxied any;
#
#     # Proxy
#     proxy_http_version 1.1;              # Version HTTP pour proxy
#     proxy_set_header Host $host;
#     proxy_set_header X-Real-IP $remote_addr;
#     proxy_cache_path /path/to/cache levels=1:2 keys_zone=my_cache:10m;
#
#     # Autres directives
#     resolver 8.8.8.8;                   # DNS pour les directives proxy
#     satisfy any;                         # Contrôle d'accès (any/all)
#     limit_rate 100k;                     # Limiter le débit
#     lingering_time 30s;                  # Temps d'attente pour connexions fermées
#     aio on;                              # E/S asynchrones
#     directio 4m;                        # Direct I/O pour fichiers >4M
#
#     # Contrôle d'accès
#     allow 192.168.1.0/24;               # Autoriser des IPs
#     deny all;                            # Refuser le reste
#
#     # Pages personnalisées
#     location = /50x.html {
#         root /usr/share/nginx/html;
#     }
#
#     # Maintenance
#     location /maintenance.html {
#         return 503;
#     }
#
#     error_page 503 @maintenance;
#     location @maintenance {
#         root /var/www/maintenance;
#         rewrite ^(.*)$ /maintenance.html break;
#     }
# }
